





function getAPIdata(position) { 

   $.getJSON("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/95c30dce4b72f89f206392b72e2b2f8f/" +
    position.coords.latitude + "," + position.coords.longitude, function(weatherData) {

      overview.innerHTML += weatherData.currently.summary + "<br>";
      temp.innerHTML += Math.round(weatherData.currently.temperature) + "&deg;<br>";
      feelsLikeTemp.innerHTML += "Feels Like " + Math.round(weatherData.currently.apparentTemperature)+"&deg;";
      humidity.innerHTML += "humidity " + weatherData.currently.humidity*100 + "%<br>";
      windSpeed.innerHTML += "Wind " + Math.ceil(weatherData.currently.windSpeed) +" MPH " + findWindDirection(weatherData.currently.windBearing);+ "<br>";
      rainProbability.innerHTML += "Precipitation Chance " + Math.round(weatherData.currently.precipProbability*100) + "%<br>";
      document.getElementById("icon").style.backgroundImage = 'url(img/' + weatherData.currently.icon + '.png)';
      populateHourly(weatherData.hourly.data);
      populateDaily(weatherData.daily.data);
      $('.loading').hide();
      $('.page-wrap').show();
      var d = new Date();
      //alert(d+"   hi   "+ new Date(weatherData.hourly.data[2].time));
  });
}

var dayOfWeek = [
  'Sunday',
  'Monday',
  'Tuesday',
  'Wednesday',
  'Thursday',
  'Friday',
  'Saturday'
];

function populateHourly(hourlyData){
  for(var i=0;i<8;i++){
    $('.hourly-list').append("<li class='hourly-item'><p id='hourlyTime'>"+getHourOfDay(hourlyData[i])+"</p><p id='hourlyChanceOfRain'>Chance of rain "+Math.round(hourlyData[i].precipProbability*100)+"%</p><p id='hourlyTemp'>"+Math.round(hourlyData[i].temperature)+"&deg;</p><img id='hourlyIcon' src='img/"+hourlyData[i].icon+".png' /></li>");
  }
}

function populateDaily(hourlyData){
  for(var i=0;i<8;i++){
     $('.daily-list').append("<li class='daily-item'><p id='dailyDayOfWeek'>"+dayOfWeek[new Date(hourlyData[i].time*1000).getDay()]+"</p><p id='dailyChanceOfRain'>Chance of rain "+Math.round(hourlyData[i].precipProbability*100)+"%</p><p id='dailyHighTemp'>High "+Math.round(hourlyData[i].temperatureMax)+"&deg;</p><p id='dailyLowTemp'>Low "+Math.round(hourlyData[i].temperatureMin)+"&deg;</p><img id='dailyIcon' src='img/"+hourlyData[i].icon+".png' /></li>");
  }
}

function getHourOfDay(timeData){
  //var timeD = timeData.getHours();
  var timeD = new Date(timeData.time*1000).getHours();
  if(timeD<=12 && timeD>0){
    return timeD+":00";
  }else if(timeD = 0){
    return "12:00"
  }else{
    return timeD-12+":00";
  }
  
}


function findWindDirection(directionDeg){
  var deg = directionDeg/45;
  if(deg<=1){
    return "N";
  }else if(deg<=2 && deg>1){
    return "NE";
  }else if(deg<=3 && deg>2){
    return "E";
  }else if(deg<=4 && deg>3){
    return "SE";
  }else if(deg<=5 && deg>4){
    return "S";
  }else if(deg<=6 && deg>5){
    return "SW";
  }else if(deg<=7 && deg>6){
    return "W";
  }else if(deg<=8 && deg>7){
    return "NW";
  }else{
    return "";
  }

}




var locationMsg = document.getElementById("locationMessage");

function getLocation() {
    if (navigator.geolocation) {
   navigator.geolocation.getCurrentPosition(showPosition);
    } else { 
        locationMsg.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function showPosition(position) {
        getAPIdata(position);
}

window.onLoad = getLocation();

